# Title: CVE-Agregator.py
# Description: A script to scrape CVEs from the NVD on Security website.

#Libraries
import requests
from datetime import datetime, timedelta, timezone

#function for fetching CVE data from NVD API
def fetch_cve_data(days_back):
    #define the parameters for the API request to get CVEs published in the last 'days_back' days
    params = {
        "pubStartDate": (datetime.now(timezone.utc) - timedelta(days=days_back)).isoformat(),
        "pubEndDate": datetime.now(timezone.utc).isoformat()
    }
    
    # Fetch CVE data from NVD API
    data = requests.get("https://services.nvd.nist.gov/rest/json/cves/2.0", params=params).json()
    
    return data.get("vulnerabilities", [])

#functions for loop and print statements
def display_cves(cves):
    
    #loop through the parsed data and print CVE ID, severity, description, and published date
    for item in cves:
        cve_id = item.get("cve", {}).get("id", "N/A")
        published_date = item.get("cve", {}).get("published", "N/A")[0:10]
        severity = item.get("cve", {}).get("metrics", {}).get("cvssMetricV31", [{}])[0].get("cvssData", {}).get("baseSeverity", "N/A")
        description = item.get("cve", {}).get("descriptions", {})[0].get("value", "N/A")
        
        # Print the published date, CVE ID, severity, and description for each vulnerability
        print(f"Published Date: {published_date}\n \n CVE ID: {cve_id}\n \n Severity: {severity}\n \n Description: {description}")
        print("\n\n")

display_cves(fetch_cve_data(7))
