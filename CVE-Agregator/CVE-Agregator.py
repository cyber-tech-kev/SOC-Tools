#!/usr/bin/env python3

# Title: CVE-Agregator.py
# Description: A script to scrape CVEs from the NVD on Security website.

#Libraries
import sys
sys.stdout.reconfigure(encoding='utf-8')
import requests
from datetime import datetime, timedelta, timezone

#variables 
days_back = 7

params = {
    "pubStartDate": (datetime.now(timezone.utc) - timedelta(days=days_back)).isoformat(),
    "pubEndDate": datetime.now(timezone.utc).isoformat()
}

# Fetch CVE data from NVD API
data = requests.get("https://services.nvd.nist.gov/rest/json/cves/2.0", params=params).json()

#unpack the data and get the vulnerabilities list
parsed_data = data.get("vulnerabilities", {})

#loop through the parsed data and print CVE ID, severity, description, and published date
for item in parsed_data:
    cve_id = item.get("cve", {}).get("id", "N/A")
    published_date = item.get("cve", {}).get("published", "N/A")[0:10]
    severity = item.get("cve", {}).get("metrics", {}).get("cvssMetricV31", [{}])[0].get("cvssData", {}).get("baseSeverity", "N/A")
    descriiption = item.get("cve", {}).get("descriptions", {})[0].get("value", "N/A")
    print()
   
# Print the published date, CVE ID, severity, and description for each vulnerability
    print(f"Published Date: {published_date}\n\n CVE ID: {cve_id}\n\n Severity: {severity}\n\n Description: {descriiption}\n\n\n\n")
